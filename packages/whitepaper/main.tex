\documentclass[9pt,oneside]{amsart}
%\usepackage{tweaklist}
\usepackage{cancel}
\usepackage{xspace}
\usepackage{graphicx}
\usepackage{multicol}
\usepackage{subfig}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[a4paper,width=170mm,top=18mm,bottom=22mm,includeheadfoot]{geometry}
\usepackage{booktabs}
\usepackage{array}
\usepackage{verbatim}
\usepackage{caption}
\usepackage{natbib}
\usepackage{float}
\usepackage{pdflscape}
\usepackage{mathtools}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{afterpage}
\usepackage{tikz}
\usepackage[bookmarks=true, unicode=true, pdftitle={Ethereum Yellow Paper: a formal specification of Ethereum, a programmable blockchain}, pdfauthor={Dr. Gavin Wood},pdfkeywords={Ethereum, Yellow Paper, blockchain, virtual machine, cryptography, decentralised, singleton, transaction, generalised},pdfborder={0 0 0.5 [1 3]}]{hyperref}
%,pagebackref=true

\usepackage{tabu} %requires array.

%This should be the last package before \input{Version.tex}
\PassOptionsToPackage{hyphens}{url}\usepackage{hyperref}
% "hyperref loads the url package internally. Use \PassOptionsToPackage{hyphens}{url}\usepackage{hyperref} to pass the option to the url package when it is loaded by hyperref. This avoids any package option clashes." Source: <https://tex.stackexchange.com/questions/3033/forcing-linebreaks-in-url/3034#comment44478_3034>.
% Note also this: "If the \PassOptionsToPackage{hyphens}{url} approach does not work, maybe it's "because you're trying to load the url package with a specific option, but it's being loaded by one of your packages before that with a different set of options. Try loading the url package earlier than the package that requires it. If it's loaded by the document class, try using \RequirePackage[hyphens]{url} before the document class." Source: <https://tex.stackexchange.com/questions/3033/forcing-linebreaks-in-url/3034#comment555944_3034>.
% For more information on using the hyperref package, refer to e.g. https://en.wikibooks.org/w/index.php?title=LaTeX/Hyperlinks&stable=0#Hyperlink_and_Hypertarget.

\makeatletter
 \newcommand{\linkdest}[1]{\Hy@raisedlink{\hypertarget{#1}{}}}
\makeatother
\usepackage{seqsplit}

% For formatting
%\usepackage{underscore}
%\usepackage{lipsum} % to generate filler text for testing of document rendering
\usepackage[english]{babel}
\usepackage[autostyle]{csquotes}
\MakeOuterQuote{"}

\usepackage[final]{microtype} % https://tex.stackexchange.com/questions/75140/is-it-possible-to-make-latex-mark-overfull-boxes-in-the-output#comment382776_75142


% Default rendering options
\definecolor{pagecolor}{rgb}{1,1,1}
\def\YellowPaperVersionNumber{0.1.0}
\IfFileExists{Options.tex}{\input{Options.tex}}

\newcommand{\hcancel}[1]{%
    \tikz[baseline=(tocancel.base)]{
        \node[inner sep=0pt,outer sep=0pt] (tocancel) {#1};
        \draw[black] (tocancel.south west) -- (tocancel.north east);
    }%
}%


\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\newcommand*\eg{e.g.\@\xspace}
\newcommand*\Eg{e.g.\@\xspace}
\newcommand*\ie{i.e.\@\xspace}
%\renewcommand{\itemhook}{\setlength{\topsep}{0pt}  \setlength{\itemsep}{0pt}\setlength{\leftmargin}{15pt}}

\title[TAIKO: A Tier-1 Ethereum ZK-Rollup\\ \smaller \textbf{{Berlin version}}]{TAIKO: A Tier-1 Ethereum ZK-Rollup \\ \smaller \textbf{{DRAFT \YellowPaperVersionNumber}}}

\author{
  Daniel WANG\\
  \texttt{dan@taiko.xyz}
  \and
  Brecht Devos\\
  \texttt{brecht@taiko.xyz}
   \and
  Matthew Finestone\\
  \texttt{matthew@taiko.xyz}
}
\begin{document}

\pagecolor{pagecolor}

\begin{abstract}
The blockchain paradigm when coupled with cryptographically-secured transactions has demonstrated its utility through a number of projects, with Bitcoin being one of the most notable ones. Each such project can be seen as a simple application on a decentralised, but singleton, compute resource. We can call this paradigm a transactional singleton machine with shared-state.

Ethereum implements this paradigm in a generalised manner. Furthermore it provides a plurality of such resources, each with a distinct state and operating code but able to interact through a message-passing framework with others. We discuss its design, implementation issues, the opportunities it provides and the future hurdles we envisage.
\end{abstract}

\maketitle

\setlength{\columnsep}{20pt}
\begin{multicols}{2}


\section{Introduction}

Your introduction goes here! Simply start writing your document and use the Recompile button to view the updated PDF preview. Examples of commonly used commands and features are listed below, to help you get started.

Once you're familiar with the editor, you can find various project settings in the Overleaf menu, accessed via the button in the very top left of the editor. To view tutorials, user guides, and further documentation, please visit our \href{https://www.overleaf.com/learn}{help library}, or head to our plans page to \href{https://www.overleaf.com/user/subscription/plans}{choose your plan}.

\section{Rollup Contracts}
Taiko ZK-Rollup protocol has two major smart contracts deployed on L1 and L2 respectively.

\subsection{TaikoL1.} Deployed at address $\mathbf{r_{\mathrm{1}}}$ on Ethereum, this contract is used to propose, prove, and finalize blocks. TaikoL1 maintains the following rollup state variables:

\begin{description}
\item[nextBlockId] The ID for the next proposed block, formally $R_\mathrm{i}$.
\item[lastFinalizedBlockId] The ID of the last finalized block, formally $R_\mathrm{f}$.
% \item [numUnprovenBlocks] The number of proposed blocks that have not been proven,  formally $R_\mathrm{n}$.
\item [blockCommits] The mapping from proposed block \textbf{commit hashes} to their enclosed L1 blocks' block numbers, formally $R_\mathrm{c}$. If a block's hash is $h$, the commit hash number is $R_\mathrm{c}[h]$.
\item [forkChoices] The mapping from proposed block IDs to their \textbf{Fork Choices} , formally $R_\mathrm{f}$. The fork choices for the $i$-th block is $R_\mathrm{f}[i]$. Fork choices is discussed in detail in section \ref{sec:forkchoices}
\end{description}




\subsection{TaikoL2.} Deployed at address $\mathbf{r_{\mathrm{2}}}$ on Taiko, this contracts offers two major functionalities:
\begin{itemize}
\item Proving a proposed block is invalid on L2 through a valid but throwaway block.
\item Achieving \textbf{anchoring}, an important concept in Taiko's design to ensure blocks are valid and crosss-layer data exchanges are done right.
\end{itemize}

\section{Blocks and Transactions}

\subsection{Proposing Blocks}
All Taiko blocks are proposed permissionlessly on Ethereum then converted to actual L2 blocks if they are proven to be valid, or ignored if they are proven to be invalid.

\subsubsection{Proposed Block.} The proposed block in Taiko is the collection of information (known as the block \textit{context}), $C$, and a list of transactions, $L$,  (known as the block \textit{txList}). Formally, we can refer to a proposed block $\bar{B}$:

\begin{equation}
\bar{B} \equiv (\bar{B}_{\mathrm{C}}, \bar{B}_{\mathbf{L}})
\end{equation}

\subsubsection{Block Context} The block context, $C$, is a tuple of 1000000 items comprising:


  
    
\begin{description}
\item[id] A scalar value equal to the number of already proposed blocks.The genesis block has a number of zero; formally $C_{\mathrm{i}}$.
\item[beneficiary] The 160-bit address to which all fees collected from the corresponding L2 block be transferred; formally $C_{\mathrm{c}}$.
\item[gasLimit] The total gas limit used by the corresponding L2 block; formally $C_{\mathrm{l}}$.
\item[proposedAt] The timestamp when this block is proposed on L1; formally $C_{\mathrm{s}}$.
\item[mixHash] The mixHash value to be used by the corresponding L2 block; formally $C_{\mathrm{m}}$.
\item[extraData] The extraData value to be used by the corresponding L2 block;. This must be 32 bytes or fewer; formally $C_{\mathrm{x}}$.
\item[txListHash] The Keccak 256-bit hash (or the KZG polynomial commitment when EIP-4844 is enabled) of this block's txList; formally $C_{\mathrm{t}}$. 
\item[anchorHeight] The enclosing L1 block's parent block number; formally $C_{\mathrm{a}}$.
\item[anchorHash] The enclosing L1 block's parent block hash; formally $C_{\mathrm{h}}$.
\end{description}

\subsubsection{txList}
The txList is a RLP-serialised list of proposed L2 transactions. In a future version, when  EIP-4844 is enabled, the content of txList will be no longer direct accessible from \textbf{TaikoL1} contract.

\subsubsection{Proposed Block Validity}
The proposed block must pass a validity test before it is accepted by the \textbf{TaikoL1} contract.  We are able to define the proposed block validity function $V(\bar{B})$:

\begin{eqnarray}
V(\bar{B}) & \equiv &   V(C,L)  \\
\nonumber & \equiv &   R_\mathbf{i} \le R_\mathbf{f} + K_\mathrm{pendingblocks}   \quad \wedge \\
\nonumber& & \lVert L \rVert > 0 \quad \wedge \\
\nonumber & & \lVert L \rVert \le K_{\mathrm{blocktxlistbytelimit}} \quad \wedge \\
\nonumber& & C_{\mathbf{c}} \ne 0   \quad \wedge \\
\nonumber& & C_{\mathbf{i}} = R_\mathbf{i}   \quad \wedge \\
\nonumber& & C_{\mathbf{s}} = \mathrm{TIMESTAMP}   \quad \wedge \\
\nonumber& & C_{\mathbf{m}} = \mathrm{DIFFICULTY}   \quad \wedge \\
\nonumber& & C_{\mathbf{t}} \ne 0   \quad \wedge \\
\nonumber& & C_{\mathbf{t}} = \mathrm{KEC}(L)   \quad \wedge \\
\nonumber& & C_{\mathbf{a}} = \mathrm{NUMBER} - 1   \quad \wedge \\
\nonumber& & C_{\mathbf{h}} = \mathrm{BLOCKHASH}(C_{\mathbf{a}})   \quad \wedge \\
\nonumber& & R_{\mathbf{c}}[\mathrm{KEC}(C_{\mathbf{c}}, C_{\mathbf{t}})] \ne 0  \quad \wedge \\
\nonumber& & R_{\mathbf{c}}[\mathrm{KEC}(C_{\mathbf{c}}, C_{\mathbf{t}})] \le  \\
\nonumber& &  \mathrm{NUMBER}   -  K_{\mathrm{commitdelay}}  \quad \wedge \\
\end{eqnarray}

\subsubsection{Commit Hash}.

\subsection{Anchoring}

\subsection{Proving Blocks} \label{sec:proving}.
\subsubsection{Fork Choices}  \label{sec:forkchoices}.



\subsection{Assumptions on zkEVM}
hi hi hi

\end{multicols}

\bibliographystyle{alpha}
\bibliography{whitepaper}

\appendix

\section{Terminology} \label{ch:Terminology}

\begin{description}
\item[External Actor] A person or other entity able to interface to an Ethereum node, but external to the world of Ethereum. It can interact with Ethereum through depositing signed Transactions and inspecting the blockchain and associated state. Has one (or more) intrinsic Accounts.

\item[Address] A 160-bit code used for identifying Accounts.

\item[Account] Accounts have an intrinsic balance and transaction count maintained as part of the Ethereum state. They also have some (possibly empty) EVM Code and a (possibly empty) Storage State associated with them. Though homogenous, it makes sense to distinguish between two practical types of account: those with empty associated EVM Code (thus the account balance is controlled, if at all, by some external entity) and those with non-empty associated EVM Code (thus the account represents an Autonomous Object). Each Account has a single Address that identifies it.

\end{description}

\section{Fee Schedule}\label{app:fees}

\nopagebreak
The fee schedule $G$ is a tuple of scalar values corresponding to the relative costs, in gas, of a number of abstract operations that a transaction may effect.

\nopagebreak
\begin{tabu}{l r l}
\toprule
Name & Value & Description \\
\midrule
$K_{\mathrm{chainid}}$ & 1337 & Nothing paid for operations of the set {\small $W_{\mathrm{zero}}$}. \\
$K_{\mathrm{pendingblocks}}$ & 2048 & Nothing paid for operations of the set {\small $W_{\mathrm{zero}}$}. \\
$K_{\mathrm{perblockfinalization}}$ & 5 & Amount of gas to pay for a {\small JUMPDEST} operation. \\
$K_{\mathrm{commitdelay}}$ & 4 & Amount of gas to pay for operations of the set {\small $W_{\mathrm{base}}$}. \\
$K_{\mathrm{perblockforks}}$ & 5 & Amount of gas to pay for operations of the set {\small $W_{\mathrm{verylow}}$}. \\
$K_{\mathrm{blockgaslimit}}$ & 1000000 & Amount of gas to pay for operations of the set {\small $W_{\mathrm{block}}$}. \\
$K_{\mathrm{blockmaxtxs}}$ & 8 & Amount of gas to pay for operations of the set {\small $W_{\mathrm{mid}}$}. \\
$K_{\mathrm{blocktxlistbytelimit}}$ & 1000000 & Amount of gas to pay for operations of the set {\small $W_{\mathrm{high}}$}. \\
$K_{\mathrm{anchorgaslimit}}$ & 100 & Cost of a warm account or storage access. \\
$K_{\mathrm{goldfingeraddr}}$ & 100 & Cost of a warm account or storage access. \\
$K_{\mathrm{goldfingerprivatekey}}$ & 100 & Cost of a warm account or storage access. \\
$K_{\mathrm{deadendmark}}$ & 1 & Cost of a warm account or storage access. \\
$K_{\mathrm{invalidblocklogtopic}}$ & 0x64b299ff...6ddea4a2 & keccak256("BlockInvalidated(bytes32)"). \\
%extern u256 const c_{\mathrm{copyGas}};            ///< Multiplied by the number of 32-byte words that are copied (round up) for any *COPY operation and added.
\bottomrule
\end{tabu}




\end{document}